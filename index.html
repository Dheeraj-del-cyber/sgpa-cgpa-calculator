<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VTU SGPA & CGPA Calculator</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f4f6fb;
    margin: 0;
    padding: 16px;
  }

  h1, h2 {
    text-align: center;
    color: #1f2937;
  }

  .container {
    max-width: 750px;
    margin: auto;
  }

  .card {
    background: white;
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  }

  .header-row,
  .row {
    display: grid;
    grid-template-columns: 0.4fr 1.4fr 0.6fr 0.6fr 0.4fr;
    gap: 8px;
    align-items: center;
  }

  .header-row {
    font-weight: 600;
    font-size: 14px;
    color: #374151;
    margin-bottom: 8px;
  }

  .row {
    margin-bottom: 10px;
  }

  .index {
    text-align: center;
    font-weight: 600;
    color: #2563eb;
  }

  input {
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #d1d5db;
    font-size: 15px;
  }

  input:focus {
    outline: none;
    border-color: #2563eb;
  }

  .fail {
    background: #fee2e2;
  }

  .fail input {
    border-color: #dc2626;
  }

  .delete {
    background: #ef4444;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px;
    cursor: pointer;
    font-weight: bold;
  }

  button.main {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: 600;
    margin-top: 10px;
    cursor: pointer;
  }

  .add { background: #2563eb; color: white; }
  .sgpa { background: #16a34a; color: white; }
  .cgpa { background: #7c3aed; color: white; }

  .result {
    margin-top: 14px;
    padding: 16px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    border-radius: 12px;
  }

  .green { background: #dcfce7; color: #166534; }
  .red { background: #fee2e2; color: #991b1b; }

  @media (max-width: 600px) {
    .header-row, .row {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>

<body>

<div class="container">
  <h1>VTU SGPA & CGPA Calculator</h1>

  <div class="card">
    <h2>Subjects</h2>

    
    <div id="subjects"></div>

    <button class="main add" onclick="addSubject()">âž• Add Subject</button>
    <button class="main sgpa" onclick="calculateSGPA()">Calculate SGPA</button>
    <div id="sgpaResult" class="result"></div>
  </div>

  <div class="card">
    <h2>CGPA (from SGPAs)</h2>
    <input id="cgpaInput" placeholder="Example: 7.8, 8.2, 6.9">
    <button class="main cgpa" onclick="calculateCGPA()">Calculate CGPA</button>
    <div id="cgpaResult" class="result"></div>
  </div>
  <div class="card">
  <h2>ðŸŽ¯ Target CGPA Planner</h2>

  <input id="currentCgpa" type="number" step="0.01" placeholder="Current CGPA (e.g. 7.2)">
  <input id="semCompleted" type="number" placeholder="Semesters Completed (e.g. 4)">
  <input id="targetCgpa" type="number" step="0.01" placeholder="Target CGPA (e.g. 8.0)">
  <input id="totalSem" type="number" value="8" placeholder="Total Semesters">

  <button class="main cgpa" onclick="calculateTarget()">Calculate Required SGPA</button>

  <div id="targetResult" class="result"></div>
  <button class="main delete" onclick="clearAll()">Clear All Data</button>
</div>
</div>

<script>
  function addSubject(data = {}) {
  const row = document.createElement("div");
  row.className = "row";
  row.innerHTML = `
    <div class="index"></div>
    <input placeholder="Subject" value="${data.subject || ""}">
    <input type="number" placeholder="Credits" value="${data.credits || ""}">
    <input type="number" placeholder="Marks" value="${data.marks || ""}" oninput="checkFail(this)">
    <button class="delete" onclick="deleteRow(this)">âœ–</button>
  `;

  row.querySelectorAll("input").forEach(inp => {
    inp.addEventListener("input", saveData);
  });

  document.getElementById("subjects").appendChild(row);
  reorder();
  setupEnterNavigation();
  saveData();
}

  function deleteRow(btn) {
    btn.parentElement.remove();
    reorder();
    saveData();
  }

  function reorder() {
    document.querySelectorAll(".index").forEach((el, i) => {
      el.textContent = i + 1;
    });
  }

  function checkFail(input) {
    const row = input.parentElement;
    if (Number(input.value) < 40 && input.value !== "") {
      row.classList.add("fail");
    } else {
      row.classList.remove("fail");
    }
  }

  function setupEnterNavigation() {
    const inputs = document.querySelectorAll("#subjects input");
    inputs.forEach((input, i) => {
      input.onkeydown = (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          if (inputs[i + 1]) {
            inputs[i + 1].focus();
          } else {
            addSubject();
            setTimeout(() => {
              document.querySelectorAll("#subjects input")[inputs.length].focus();
            }, 0);
          }
        }
      };
    });
  }

  function gradePoint(m) {
    if (m >= 90) return 10;
    if (m >= 80) return 9;
    if (m >= 70) return 8;
    if (m >= 60) return 7;
    if (m >= 55) return 6;
    if (m >= 50) return 5;
    if (m >= 40) return 4;
    return 0;
  }

  function calculateSGPA() {
    const rows = document.querySelectorAll("#subjects .row");
    let credits = 0, total = 0;

    rows.forEach(r => {
      const c = Number(r.children[2].value);
      const m = Number(r.children[3].value);
      if (c) {
        credits += c;
        total += c * gradePoint(m);
      }
    });

    if (!credits) return;
    const sgpa = (total / credits).toFixed(2);
    show("sgpaResult", "SGPA: " + sgpa, sgpa);
  }

  function calculateCGPA() {
    const vals = document.getElementById("cgpaInput").value
      .split(",")
      .map(v => Number(v.trim()))
      .filter(v => !isNaN(v));

    if (!vals.length) return;
    const cgpa = (vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(2);
    show("cgpaResult", "CGPA: " + cgpa, cgpa);
  }

  function show(id, text, value) {
    const el = document.getElementById(id);
    el.textContent = text;
    el.className = "result " + (value >= 7 ? "green" : "red");
  }
  function calculateTarget() {
  const current = Number(document.getElementById("currentCgpa").value);
  const done = Number(document.getElementById("semCompleted").value);
  const target = Number(document.getElementById("targetCgpa").value);
  const total = Number(document.getElementById("totalSem").value);

  const resultBox = document.getElementById("targetResult");

  if (
    current <= 0 || target <= 0 ||
    done <= 0 || total <= 0 ||
    done >= total
  ) {
    resultBox.textContent = "Please enter valid values";
    resultBox.className = "result red";
    return;
  }

  const required =
    ((target * total) - (current * done)) / (total - done);

  if (required <= 0) {
    resultBox.textContent = "ðŸŽ‰ Target already achievable with current CGPA";
    resultBox.className = "result green";
    return;
  }

  if (required > 10) {
    resultBox.textContent =
      "âŒ Target CGPA not realistically achievable (Required SGPA > 10)";
    resultBox.className = "result red";
    return;
  }

  let levelClass = "green";
  if (required > 7) levelClass = "yellow";
  if (required > 8.5) levelClass = "red";

  resultBox.textContent =
    "Required Average SGPA: " + required.toFixed(2);

  resultBox.className = "result " + levelClass;
}
function saveData() {
  const subjects = [];
  document.querySelectorAll("#subjects .row").forEach(r => {
    subjects.push({
      subject: r.children[1].value,
      credits: r.children[2].value,
      marks: r.children[3].value
    });
  });

  localStorage.setItem("subjects", JSON.stringify(subjects));
  localStorage.setItem("cgpaInput", document.getElementById("cgpaInput")?.value || "");
  localStorage.setItem("currentCgpa", document.getElementById("currentCgpa")?.value || "");
  localStorage.setItem("semCompleted", document.getElementById("semCompleted")?.value || "");
  localStorage.setItem("targetCgpa", document.getElementById("targetCgpa")?.value || "");
  localStorage.setItem("totalSem", document.getElementById("totalSem")?.value || "");
}
window.onload = () => {
  const savedSubjects = JSON.parse(localStorage.getItem("subjects") || "[]");

  if (savedSubjects.length) {
    document.getElementById("subjects").innerHTML = "";
    savedSubjects.forEach(s => addSubject(s));
  } else {
    addSubject();
  }

  document.getElementById("cgpaInput").value =
    localStorage.getItem("cgpaInput") || "";

  document.getElementById("currentCgpa").value =
    localStorage.getItem("currentCgpa") || "";

  document.getElementById("semCompleted").value =
    localStorage.getItem("semCompleted") || "";

  document.getElementById("targetCgpa").value =
    localStorage.getItem("targetCgpa") || "";

  document.getElementById("totalSem").value =
    localStorage.getItem("totalSem") || "8";
};
function clearAll() {
  if (confirm("This will delete all saved data. Continue?")) {
    localStorage.clear();
    location.reload();
  }
}
</script>

</body>
</html>